#!/usr/bin/env sh

# General purpose program runner
# by David Oniani <onianidavid@gmail.com>
# License: GNU GPLv3

filename="$1"
basename="${filename%.*}"

mdcompile() {
  pandoc -V fontsize=11pt \
         -V geometry:a4paper \
         -V linkcolor:blue \
         -V mainfont="Latin Modern Roman" \
         -V monofont="Hack Nerd Font" \
         -V margin=1in \
         -f markdown \
         --highlight-style=pygments \
         --pdf-engine=pdflatex \
         "$1" \
         -o \
         "$2"
}

case $filename in
  *.c) gcc -o "$basename.out" "$filename";;
  *.cpp) clang++ -Wall -std=c++17 "$filename" -o "$basename.out";;
  *.dot) dot -Tpdf "$filename" -o "$basename.pdf";;
  *.hs) runhaskell "$filename";;
  *.lua) lua "$filename";;
  *.md) mdcompile "$filename" "$basename.pdf";;
  *.py) python3 "$filename";;
  *.R) Rscript "$filename";;
  *.Rmd) Rscript -e "rmarkdown::render('$filename', 'pdf_document')";;
  *.rs) cargo run "$filename";;
  *.sh) sh "$filename";;
  *.tex) latexmk -interaction=nonstopmode -pdf -shell-escape "$filename";;
  *.ts) tsc "$filename";;
  *) printf "Unknown file format\n";;
esac
